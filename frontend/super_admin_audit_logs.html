<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit Logs - Celloxen Super Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
            min-height: 100vh;
        }
        
        .top-nav {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo-section h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo-section p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .btn:hover {
            background: white;
            color: #1e3a8a;
        }
        
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .page-header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .page-header h1 {
            color: #1e3a8a;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #3b82f6;
        }
        
        .summary-card h3 {
            color: #64748b;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .summary-card .value {
            color: #1e3a8a;
            font-size: 24px;
            font-weight: 700;
        }
        
        .logs-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .logs-container h2 {
            color: #1e3a8a;
            margin-bottom: 20px;
        }
        
        .log-entry {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        
        .log-entry:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .log-action {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .action-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .action-login {
            background: #dbeafe;
            color: #3b82f6;
        }
        
        .action-created_clinic {
            background: #dcfce7;
            color: #10b981;
        }
        
        .action-viewed_clinics_list, .action-viewed_clinic_details {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .action-updated {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .log-time {
            color: #64748b;
            font-size: 13px;
        }
        
        .log-description {
            color: #0f172a;
            margin-bottom: 8px;
        }
        
        .log-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            color: #64748b;
            font-size: 13px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        .total-count {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .log-header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="top-nav">
        <div class="logo-section">
            <h1>CELLOXEN - Super Admin</h1>
            <p>Audit Logs</p>
        </div>
        <div class="nav-buttons">
            <a href="super_admin_portal.html" class="btn">‚Üê Back to Dashboard</a>
            <button class="btn" onclick="handleLogout()">Logout</button>
        </div>
    </div>
    
    <div class="main-content">
        <div class="page-header">
            <h1>üìã Audit Logs</h1>
            <p style="color: #64748b; margin-top: 10px;">Track all Super Admin actions and system events</p>
        </div>
        
        <div id="summarySection" class="summary-grid">
            <div class="loading">Loading summary...</div>
        </div>
        
        <div class="logs-container">
            <h2>All Activity</h2>
            <div class="total-count" id="totalCount">Loading...</div>
            
            <div id="logsContainer">
                <div class="loading">Loading logs...</div>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = 'https://celloxen.com/api/v1/super-admin';
        let authToken = localStorage.getItem('superAdminToken');
        
        function handleLogout() {
            localStorage.removeItem('superAdminToken');
            window.location.href = 'super_admin_portal.html';
        }
        
        async function loadSummary() {
            try {
                const response = await fetch(`${API_BASE}/audit-logs/summary`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.summary.length > 0) {
                    const summarySection = document.getElementById('summarySection');
                    summarySection.innerHTML = '';
                    
                    data.summary.slice(0, 5).forEach(item => {
                        const card = document.createElement('div');
                        card.className = 'summary-card';
                        card.innerHTML = `
                            <h3>${item.action.replace(/_/g, ' ')}</h3>
                            <div class="value">${item.count}</div>
                        `;
                        summarySection.appendChild(card);
                    });
                } else {
                    document.getElementById('summarySection').innerHTML = '';
                }
            } catch (error) {
                console.error('Error loading summary:', error);
                document.getElementById('summarySection').innerHTML = '';
            }
        }
        
        async function loadLogs() {
            const logsContainer = document.getElementById('logsContainer');
            logsContainer.innerHTML = '<div class="loading">Loading logs...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/audit-logs?limit=100`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalCount').textContent = `Total actions: ${data.total}`;
                    logsContainer.innerHTML = '';
                    
                    if (data.logs.length === 0) {
                        logsContainer.innerHTML = '<p style="color: #64748b;">No audit logs found.</p>';
                        return;
                    }
                    
                    data.logs.forEach(log => {
                        const entry = document.createElement('div');
                        entry.className = 'log-entry';
                        
                        const actionClass = `action-${log.action}`;
                        const timestamp = new Date(log.created_at).toLocaleString('en-GB', {
                            day: '2-digit',
                            month: 'short',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                        
                        entry.innerHTML = `
                            <div class="log-header">
                                <div class="log-action">
                                    <span class="action-badge ${actionClass}">${log.action.replace(/_/g, ' ')}</span>
                                    <span style="color: #1e3a8a; font-weight: 600;">${log.admin_name}</span>
                                </div>
                                <div class="log-time">${timestamp}</div>
                            </div>
                            <div class="log-description">${log.description || 'No description'}</div>
                            <div class="log-meta">
                                ${log.resource_type ? `<span>üìã Resource: ${log.resource_type}</span>` : ''}
                                ${log.resource_id ? `<span>üî¢ ID: ${log.resource_id}</span>` : ''}
                                ${log.ip_address ? `<span>üåê IP: ${log.ip_address}</span>` : ''}
                                <span>üë§ ${log.admin_email}</span>
                            </div>
                        `;
                        
                        logsContainer.appendChild(entry);
                    });
                }
            } catch (error) {
                console.error('Error loading logs:', error);
                logsContainer.innerHTML = '<p style="color: #ef4444;">Error loading logs. Please refresh the page.</p>';
            }
        }
        
        window.onload = function() {
            if (!authToken) {
                window.location.href = 'super_admin_portal.html';
                return;
            }
            loadSummary();
            loadLogs();
        };
    </script>
</body>
</html>
